<div class="sticky top-0 bg-white">
    <div class="flex justify-between items-center gap-2 p-4">
        <h4 class="text-lg font-semibold">Chat</h4>
        @if (!searchNewContact) {
            <i class="fas fa-comment-medical cursor-pointer text-gray-600 hover:text-blue-500 transition-colors" (click)="searchContact()"></i>
        } @else {
            <i class="fas fa-times-circle cursor-pointer text-gray-600 hover:text-red-500 transition-colors" (click)="searchNewContact = false"></i>
        }
    </div>

    <div class="flex flex-col gap-2 p-4">
        <div class="flex flex-col gap-3">
            <div class="flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500">
                <i class="fas fa-search text-gray-400"></i>
                <input 
                    type="text" 
                    class="flex-1 outline-none text-sm" 
                    placeholder="Search in the chat" 
                    aria-label="Search"
                >
            </div>

            <div class="flex gap-2">
                <span class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full cursor-pointer hover:bg-gray-200 transition-colors">
                    All
                </span>
                <span class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full cursor-pointer hover:bg-gray-200 transition-colors">
                    Unread
                </span>
                <span class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full cursor-pointer hover:bg-gray-200 transition-colors">
                    Favorites
                </span>
            </div>
        </div>
    </div>
</div>

<div class="chat-list mt-3">
    @if (chats().length && !searchNewContact) {
        @for (chat of chats(); track chat.id) {
            <div class="flex items-center justify-between border-b border-b-gray-300 p-2! cursor-pointer hover:bg-gray-50 transition-colors w-full"
            (click)="chatClicked(chat)">
            
                <div class="flex gap-2 items-center flex-1">
                    <div class="user-img">
                        <img src="user.png" alt="">
                    </div>
                    <div class="flex flex-col">
                        <span class="font-semibold">{{ chat.name }}</span>
                        <small class="text-sm text-gray-600">
                            @if (chat.lastMessage === 'Attachment') {
                                <i class="fas fa-image"></i>
                            }
                            {{ wrapMessage(chat.lastMessage) }}
                        </small>
                    </div>
                </div>

                <div class="flex flex-col items-end gap-1">
                    <span class="msg-date text-xs text-gray-500"
                    [class.unread]="chat.unreadCount && chat.unreadCount > 0">
                        {{ chat.lastMessageTime | date:'dd.MM.yy HH:mm'}}
                    </span>
                    @if (chat.unreadCount && chat.unreadCount > 0) {
                        <small class="unread-msg-badge">{{ chat.unreadCount }}</small>
                    }
                </div>
            </div>
        }
    } @else if(searchNewContact) {
        @for (contact of contacts; track contact.id) {
            <div class="flex items-center justify-between border-b border-b-gray-300 p-3 cursor-pointer hover:bg-gray-50 transition-colors"
            (click)="selectContact(contact)">

                <div class="flex gap-2">
                    <div class="user-img">
                        <img src="user.png" alt="">
                    </div>
                    <div class="flex flex-col">
                        <span>{{ contact.name + ' ' + contact.lastName }}</span>

                        @if (contact.online) {
                            <small class="text-green-600">Online</small>
                        } @else {
                            <small class="text-gray-500">Last seen {{ contact.lastSeen | date:'dd.MM.yyyy HH:mm'}}</small>
                        }
                    </div>
                </div>
            </div>
        }
    } @else {
        <small class="p-4 text-gray-400 text-center block">No chat yet...</small>
    }
</div>
<div class="flex justify-center items-center bg-[#ccc] min-h-screen">
    <div class="absolute top-0 w-full h-[20%] bg-[#1ea884]"></div>

    <div class="main-container flex">
        <div class="flex flex-col justify-between items-center p-1.5! gray-bg">
            <div>
                <i class="fa-solid fa-message cursor-pointer"></i>
            </div>
            <div class="flex flex-col items-center gap-2">
                <a routerLink="/home">
                    <i class="fa-solid fa-user cursor-pointer"></i>
                </a>
                <i class="fa-solid fa-door-open cursor-pointer" (click)="logout()"></i>
            </div>
        </div>
        
        <div class="flex w-full">
            <div class="w-1/3 overflow-y-auto">
                <app-chat-list
                    [chats]="chats"
                    (chatSelected)="chatSelected($event)"
                ></app-chat-list>
            </div>
            
            @if(selectedChat?.id) {
<div class="w-2/3 flex flex-col">
                <div class="gray-bg p-2! flex items-center gap-3">
                    @if(selectedChat) {
                        <div class="user-img">
                            <img src="user.png" alt="">
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-lg">{{ selectedChat.name }}</span>
                            <div class="flex gap-1 items-center">
                                @if (selectedChat.recipientOnline) {
                                    <small class="online-status"></small>
                                    <small>Online</small>
                                } @else {
                                    <small class="offline-status"></small>
                                    <small>Offline</small> 
                                }
                            </div>
                        </div>
                    }
                </div>
                <div #scrollableDiv class="bg-chat p-3 h-full overflow-y-auto scrollbar-hide">
                    @for (message of chatMessages; track message) {
                        @if (isSelfMessage(message)) {
                            <div class="message-box self mr-4!">
                                <div class="flex flex-col">
                                    @if(message.type === 'TEXT') {
                                        <span> {{message.content}}</span>
                                    } @else if (message.media) {
                                        <img width="200" class="cursor-pointer" 
                                        [src]="'data:image/jpg;base64, ' + message.media" alt="">
                                    }
                                    <small class="text-black">
                                        {{ message.createdAt | date: 'HH:mm'}}
                                        @if (message.state === 'SENT') {
                                            <span>
                                                <i class="fas fa-check"></i>
                                            </span>
                                        } @else {
                                            <span>
                                                <i class="fas fa-check seen"></i>
                                                <i class="fas fa-check seen ml-neg"></i>
                                            </span>
                                        }
                                    </small>
                                </div>
                            </div>
                        } @else {
                            <div class="message-box friend ml-4!">
                                <div class="flex flex-col items-end">
                                    @if (message.type === 'TEXT') {
                                        <span> {{message.content}} </span>
                                    } @else if (message.media) {
                                        <img width="200" class="cursor-pointer" 
                                        [src]="'data:image/jpg;base64, ' + message.media" alt="">    
                                    }
                                    <small class="text-black"> {{message.createdAt | date: 'HH:mm'}} </small>
                                </div>
                            </div>
                        }
                    }
                </div>
                <div class="gray-bg p-2!">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-paperclip cursor-pointer"
                        (click)="inputFile.click()"
                        ></i>
                        <input 
                        #inputFile
                        type="file"
                        [hidden]="true"
                        accept=".jpg, .jpeg, .png, .svg, .mp4, .mov, .mp3"
                        (change)="uploadMedia($event.target)"
                        >
                        <i class="fa-regular fa-face-smile cursor-pointer"
                        (click)="showEmojis = !showEmojis">
                        </i>
                        @if (showEmojis) {
                            <emoji-mart
                            [set]="'google'"
                            title="Pick your emoji"
                            emoji="smile"
                            class="emojis-panel"
                            (emojiClick)="onSelectEmojis($event)"
                            ></emoji-mart>
                        }
                        <input type="text"
                        class="w-full text-black bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        placeholder=" Type a message"
                        [(ngModel)]="messageContent"
                        (keydown)="keyDown($event)"
                        (click)="onClick()"
                        >

                        @if (messageContent) {
                            <i class="fas fa-paper-plane cursor-pointer" (click)="sendMessage()"></i>
                        } @else {
                            <i class="fas fa-microphone cursor-pointer"></i>
                        }
                    </div>
                </div>
            </div>
            } @else {
                <div class="flex flex-col justify-center items-center w-2/3 bg-chat">
                    <img width="300px" src="wa_banner.png" alt="">
                    <h2>WhatsApp clone Application</h2>
                    <p class="text-black">...</p>
                </div>
            }
            
        </div>
    </div>
</div>